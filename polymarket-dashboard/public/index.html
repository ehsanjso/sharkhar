<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Polymarket Paper Trading</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes pulse-green { 0%, 100% { background-color: rgb(34 197 94 / 0.2); } 50% { background-color: rgb(34 197 94 / 0.4); } }
    @keyframes pulse-red { 0%, 100% { background-color: rgb(239 68 68 / 0.2); } 50% { background-color: rgb(239 68 68 / 0.4); } }
    .pulse-up { animation: pulse-green 2s ease-in-out infinite; }
    .pulse-down { animation: pulse-red 2s ease-in-out infinite; }
    .glass { backdrop-filter: blur(10px); background: rgba(255,255,255,0.05); }
  </style>
</head>
<body class="bg-gray-950 text-white min-h-screen">
  <div class="max-w-7xl mx-auto px-4 py-8">
    <!-- Header -->
    <header class="flex items-center justify-between mb-8">
      <div>
        <h1 class="text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-500 bg-clip-text text-transparent">
          ðŸ“Š Polymarket Paper Trading
        </h1>
        <p class="text-gray-400 text-sm mt-1">Simulation Mode â€” No Real Money</p>
      </div>
      <div class="flex items-center gap-4">
        <span id="btc-price" class="text-sm font-mono text-gray-400">BTC: Loading...</span>
        <span id="clock" class="text-sm font-mono text-gray-400"></span>
      </div>
    </header>

    <!-- Portfolio Summary -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
      <div class="glass rounded-xl p-6 border border-gray-800">
        <p class="text-gray-400 text-sm">Portfolio Value</p>
        <p id="portfolio-value" class="text-3xl font-bold text-green-400">$1,000.00</p>
      </div>
      <div class="glass rounded-xl p-6 border border-gray-800">
        <p class="text-gray-400 text-sm">Cash Available</p>
        <p id="cash" class="text-2xl font-bold">$850.00</p>
      </div>
      <div class="glass rounded-xl p-6 border border-gray-800">
        <p class="text-gray-400 text-sm">Total P&L</p>
        <p id="pnl" class="text-2xl font-bold text-green-400">+$0.00</p>
      </div>
      <div class="glass rounded-xl p-6 border border-gray-800">
        <p class="text-gray-400 text-sm">Win Rate</p>
        <p id="winrate" class="text-2xl font-bold">â€”</p>
      </div>
    </div>

    <!-- Active Market -->
    <div class="glass rounded-xl p-6 border border-gray-800 mb-8">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold">ðŸ”¥ Active Market</h2>
        <span id="market-status" class="px-3 py-1 rounded-full text-xs font-medium bg-green-500/20 text-green-400">LIVE</span>
      </div>
      <div id="active-market" class="space-y-4">
        <div class="flex items-center justify-between">
          <div>
            <h3 id="market-title" class="text-lg font-medium">Bitcoin Up or Down</h3>
            <p id="market-desc" class="text-sm text-gray-400">Will BTC be higher in 1 hour?</p>
          </div>
          <div class="text-right">
            <p class="text-sm text-gray-400">Opens at</p>
            <p id="open-price" class="font-mono text-lg">$69,686.69</p>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4">
          <div id="yes-card" class="p-4 rounded-lg bg-green-500/10 border border-green-500/30 cursor-pointer hover:bg-green-500/20 transition">
            <div class="flex justify-between items-center">
              <span class="text-green-400 font-semibold">YES (UP)</span>
              <span id="yes-odds" class="text-2xl font-bold text-green-400">50%</span>
            </div>
            <p class="text-sm text-gray-400 mt-1">Click to bet UP</p>
          </div>
          <div id="no-card" class="p-4 rounded-lg bg-red-500/10 border border-red-500/30 cursor-pointer hover:bg-red-500/20 transition">
            <div class="flex justify-between items-center">
              <span class="text-red-400 font-semibold">NO (DOWN)</span>
              <span id="no-odds" class="text-2xl font-bold text-red-400">50%</span>
            </div>
            <p class="text-sm text-gray-400 mt-1">Click to bet DOWN</p>
          </div>
        </div>

        <div class="flex items-center gap-4 pt-4 border-t border-gray-800">
          <div class="flex-1">
            <label class="text-sm text-gray-400">Bet Amount ($)</label>
            <input id="bet-amount" type="number" value="10" min="1" max="100" class="w-full bg-gray-800 rounded px-3 py-2 mt-1 focus:outline-none focus:ring-2 focus:ring-purple-500">
          </div>
          <div class="flex-1">
            <label class="text-sm text-gray-400">Time Remaining</label>
            <p id="time-remaining" class="text-lg font-mono mt-1">59:42</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Open Positions -->
    <div class="glass rounded-xl p-6 border border-gray-800 mb-8">
      <h2 class="text-xl font-semibold mb-4">ðŸ“ˆ Open Positions</h2>
      <div id="positions" class="space-y-3">
        <p class="text-gray-500 text-sm">No open positions</p>
      </div>
    </div>

    <!-- Recent Trades -->
    <div class="glass rounded-xl p-6 border border-gray-800">
      <h2 class="text-xl font-semibold mb-4">ðŸ“œ Recent Trades</h2>
      <div id="trades" class="space-y-2">
        <p class="text-gray-500 text-sm">No trades yet</p>
      </div>
    </div>
  </div>

  <script>
    // State
    let state = {
      cash: 1000,
      positions: [],
      trades: [],
      currentMarket: null,
      btcOpen: null,
      marketEnd: null
    };

    // Load state from localStorage
    function loadState() {
      const saved = localStorage.getItem('polymarket-state');
      if (saved) {
        state = JSON.parse(saved);
      }
      return state;
    }

    function saveState() {
      localStorage.setItem('polymarket-state', JSON.stringify(state));
    }

    // Fetch BTC price
    async function fetchBTC() {
      try {
        const res = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');
        const data = await res.json();
        return parseFloat(data.price);
      } catch {
        return null;
      }
    }

    // Update clock
    function updateClock() {
      const now = new Date();
      document.getElementById('clock').textContent = now.toLocaleTimeString();
    }

    // Update market timer
    function updateTimer() {
      if (!state.marketEnd) return;
      const now = Date.now();
      const remaining = state.marketEnd - now;
      if (remaining <= 0) {
        document.getElementById('time-remaining').textContent = 'RESOLVING...';
        resolveMarket();
        return;
      }
      const mins = Math.floor(remaining / 60000);
      const secs = Math.floor((remaining % 60000) / 1000);
      document.getElementById('time-remaining').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    // Create new market
    async function createMarket() {
      const btc = await fetchBTC();
      if (!btc) return;
      
      state.btcOpen = btc;
      state.marketEnd = Date.now() + 60 * 60 * 1000; // 1 hour from now
      state.currentMarket = {
        id: Date.now(),
        title: 'Bitcoin Up or Down',
        description: `Will BTC be higher than $${btc.toLocaleString(undefined, {minimumFractionDigits: 2})} in 1 hour?`,
        openPrice: btc,
        yesOdds: 50,
        noOdds: 50
      };
      
      document.getElementById('market-title').textContent = state.currentMarket.title;
      document.getElementById('market-desc').textContent = state.currentMarket.description;
      document.getElementById('open-price').textContent = `$${btc.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
      
      saveState();
    }

    // Place bet
    function placeBet(side) {
      const amount = parseFloat(document.getElementById('bet-amount').value);
      if (isNaN(amount) || amount <= 0 || amount > state.cash) {
        alert('Invalid bet amount');
        return;
      }

      state.cash -= amount;
      state.positions.push({
        id: Date.now(),
        marketId: state.currentMarket.id,
        side: side,
        amount: amount,
        odds: side === 'YES' ? state.currentMarket.yesOdds : state.currentMarket.noOdds,
        openPrice: state.btcOpen,
        timestamp: new Date().toISOString()
      });

      saveState();
      renderUI();
    }

    // Resolve market
    async function resolveMarket() {
      const btc = await fetchBTC();
      if (!btc || !state.btcOpen) return;

      const isUp = btc > state.btcOpen;
      const winner = isUp ? 'YES' : 'NO';

      for (const pos of state.positions) {
        if (pos.marketId === state.currentMarket.id) {
          const won = pos.side === winner;
          const payout = won ? pos.amount * (100 / pos.odds) : 0;
          state.cash += payout;
          
          state.trades.push({
            ...pos,
            closePrice: btc,
            won: won,
            payout: payout,
            pnl: payout - pos.amount,
            resolvedAt: new Date().toISOString()
          });
        }
      }

      state.positions = state.positions.filter(p => p.marketId !== state.currentMarket.id);
      state.currentMarket = null;
      state.btcOpen = null;
      state.marketEnd = null;

      saveState();
      setTimeout(createMarket, 5000); // Create new market in 5 seconds
      renderUI();
    }

    // Render UI
    function renderUI() {
      // Portfolio value
      const positionsValue = state.positions.reduce((sum, p) => sum + p.amount, 0);
      document.getElementById('portfolio-value').textContent = `$${(state.cash + positionsValue).toLocaleString(undefined, {minimumFractionDigits: 2})}`;
      document.getElementById('cash').textContent = `$${state.cash.toLocaleString(undefined, {minimumFractionDigits: 2})}`;

      // P&L
      const totalPnl = state.trades.reduce((sum, t) => sum + (t.pnl || 0), 0);
      const pnlEl = document.getElementById('pnl');
      pnlEl.textContent = `${totalPnl >= 0 ? '+' : ''}$${totalPnl.toFixed(2)}`;
      pnlEl.className = `text-2xl font-bold ${totalPnl >= 0 ? 'text-green-400' : 'text-red-400'}`;

      // Win rate
      const resolved = state.trades.filter(t => t.won !== undefined);
      const wins = resolved.filter(t => t.won).length;
      document.getElementById('winrate').textContent = resolved.length ? `${Math.round(wins / resolved.length * 100)}%` : 'â€”';

      // Positions
      const positionsEl = document.getElementById('positions');
      if (state.positions.length === 0) {
        positionsEl.innerHTML = '<p class="text-gray-500 text-sm">No open positions</p>';
      } else {
        positionsEl.innerHTML = state.positions.map(p => `
          <div class="flex justify-between items-center p-3 rounded-lg ${p.side === 'YES' ? 'bg-green-500/10' : 'bg-red-500/10'}">
            <div>
              <span class="font-medium">${p.side}</span>
              <span class="text-gray-400 text-sm ml-2">@ ${p.odds}%</span>
            </div>
            <span class="font-mono">$${p.amount.toFixed(2)}</span>
          </div>
        `).join('');
      }

      // Trades
      const tradesEl = document.getElementById('trades');
      if (state.trades.length === 0) {
        tradesEl.innerHTML = '<p class="text-gray-500 text-sm">No trades yet</p>';
      } else {
        tradesEl.innerHTML = state.trades.slice(-10).reverse().map(t => `
          <div class="flex justify-between items-center p-2 rounded ${t.won ? 'bg-green-500/10' : 'bg-red-500/10'}">
            <div>
              <span class="${t.won ? 'text-green-400' : 'text-red-400'}">${t.won ? 'âœ“' : 'âœ—'}</span>
              <span class="ml-2">${t.side}</span>
              <span class="text-gray-500 text-xs ml-2">${new Date(t.resolvedAt).toLocaleString()}</span>
            </div>
            <span class="font-mono ${t.pnl >= 0 ? 'text-green-400' : 'text-red-400'}">
              ${t.pnl >= 0 ? '+' : ''}$${t.pnl.toFixed(2)}
            </span>
          </div>
        `).join('');
      }
    }

    // Live price updates
    async function updatePrices() {
      const btc = await fetchBTC();
      if (btc) {
        const btcEl = document.getElementById('btc-price');
        const change = state.btcOpen ? ((btc - state.btcOpen) / state.btcOpen * 100) : 0;
        btcEl.textContent = `BTC: $${btc.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
        btcEl.className = `text-sm font-mono ${change >= 0 ? 'text-green-400' : 'text-red-400'}`;

        // Update odds based on price movement
        if (state.currentMarket && state.btcOpen) {
          const percentMove = (btc - state.btcOpen) / state.btcOpen * 100;
          // Simple odds adjustment based on current price vs open
          state.currentMarket.yesOdds = Math.min(95, Math.max(5, 50 + percentMove * 10));
          state.currentMarket.noOdds = 100 - state.currentMarket.yesOdds;
          
          document.getElementById('yes-odds').textContent = `${Math.round(state.currentMarket.yesOdds)}%`;
          document.getElementById('no-odds').textContent = `${Math.round(state.currentMarket.noOdds)}%`;
          
          // Visual pulse effect
          const yesCard = document.getElementById('yes-card');
          const noCard = document.getElementById('no-card');
          yesCard.classList.toggle('pulse-up', percentMove > 0.1);
          noCard.classList.toggle('pulse-down', percentMove < -0.1);
        }
      }
    }

    // Event listeners
    document.getElementById('yes-card').addEventListener('click', () => placeBet('YES'));
    document.getElementById('no-card').addEventListener('click', () => placeBet('NO'));

    // Initialize
    loadState();
    renderUI();
    updateClock();

    if (!state.currentMarket) {
      createMarket();
    }

    setInterval(updateClock, 1000);
    setInterval(updateTimer, 1000);
    setInterval(updatePrices, 5000);
    updatePrices();
  </script>
</body>
</html>
